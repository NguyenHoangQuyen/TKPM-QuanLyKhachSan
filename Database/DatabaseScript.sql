USE MASTER
GO
IF DB_ID('QLKHACHSAN') IS NOT NULL
	DROP DATABASE QLKHACHSAN
GO
GO
CREATE DATABASE QLKHACHSAN
GO
USE QLKHACHSAN
GO

CREATE TABLE HOADONTHUEPHONG(
	MaHoaDon int IDENTITY(1,1) NOT NULL,
	ThoiGianThue datetime NOT NULL,
	ThoiGianTra datetime NULL,
	TongTien float NULL,
	NhanVienTaoHoaDon int NOT NULL,
	Phong varchar(10) NOT NULL,
	MaKhachHang int NOT NULL,
	NgayTao datetime NOT NULL CONSTRAINT DF_HOADONTHUEPHONG_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_HOADONTHUEPHONG PRIMARY KEY CLUSTERED (MaHoaDon ASC))
GO
CREATE TABLE KHACHHANG(
	MaKH int IDENTITY(1,1) NOT NULL,
	HoTen nvarchar(100) NOT NULL,
	SDT numeric(10, 0) NOT NULL,
	DiaChi nvarchar(200) NULL,
	CMND numeric(15, 0) NOT NULL,
	TinhTrang bit NOT NULL,
	NgayTao datetime NOT NULL CONSTRAINT DF_KHACHHANG_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_KHACHHANG 
	PRIMARY KEY CLUSTERED (MaKH ASC)
)

GO

CREATE TABLE LICHSUTHEMDICHVU(
	ThoiGianThem datetime NOT NULL CONSTRAINT DF_LICHSUTHEMDICHVU_ThoiGianthem  DEFAULT (getdate()),
	SoLuong int NOT NULL,
	MaHoaDon int NOT NULL,
	DichVuID varchar(10) NOT NULL,
	CONSTRAINT PK_LICHSUTHEMDICHVU 
	PRIMARY KEY CLUSTERED 
	(
	ThoiGianThem ASC,
	MaHoaDon ASC,
	DichVuID ASC
	)
)

GO

CREATE TABLE LOAIDV(
	LoaiDVID varchar(10) NOT NULL,
	TenLoai nvarchar(200) NOT NULL,
	TinhTrang bit NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT DF_LOAIDV_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_LOAIDV 
	PRIMARY KEY CLUSTERED (LoaiDVID ASC))


GO
CREATE TABLE DICHVU(
	DichVuID varchar(10) NOT NULL,
	TenDichVu nvarchar(200) NOT NULL,
	GiaBan float NOT NULL,
	GiaCungCap float NOT NULL,
	TinhTrangTonTai bit NOT NULL,
	LoaiDVID varchar(10) NOT NULL,
	DonVi nvarchar(50) NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT DF_DICHVU_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_DICHVU 
	PRIMARY KEY (DichVuID ASC))
go
CREATE TABLE LOAIPHONG(
	LoaiPhongID varchar(10) NOT NULL,
	TenLoai nvarchar(200) NOT NULL,
	TinhTrang bit NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT DF_LOAIPHONG_NgayTao  DEFAULT (getdate()),
	 CONSTRAINT PK_LOAIPHONG 
	 PRIMARY KEY CLUSTERED (LoaiPhongID ASC)
)
GO
CREATE TABLE PHONG(
	PhongID varchar(10) NOT NULL,
	TenPhong nvarchar(200) NOT NULL,
	DonGia float NOT NULL,
	TinhTrangTonTai bit NOT NULL,
	TinhTrangThue bit NOT NULL,
	LoaiPhongID varchar(10) NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT DF_PHONG_NgayTao  DEFAULT (getdate()),
	 CONSTRAINT PK_PHONG 
	 PRIMARY KEY CLUSTERED (PhongID ASC)
)
GO

CREATE TABLE NHANVIEN(
	NhanVienID int IDENTITY(1,1) NOT NULL,
	TenDangNhap varchar(50) NOT NULL,
	MatKhau varchar(100) NOT NULL,
	TinhTrang bit NOT NULL,
	HoTen nvarchar(100) NOT NULL,
	DiaChi nvarchar(200) NOT NULL,
	NgaySinh date NOT NULL,
	SDT numeric(10, 0) NOT NULL,
	CMND numeric(15, 0) NOT NULL,
	Email varchar(50) NULL,
	Loai int NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT DF_NHANVIEN_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_NHANVIEN 
	PRIMARY KEY CLUSTERED (NhanVienID ASC)
)

GO

CREATE TABLE NVKETOAN(
	NhanVienID int NOT NULL,
	 CONSTRAINT PK_NVKETOAN PRIMARY KEY CLUSTERED(NhanVienID ASC)
)

GO
CREATE TABLE NVLETAN(
	NhanVienID int NOT NULL,
	CONSTRAINT PK_NVLETAN 
	PRIMARY KEY CLUSTERED (NhanVienID ASC)
)

GO
CREATE TABLE NVQUANLI(
	NhanVienID int NOT NULL,
	CONSTRAINT PK_NVQUANLI 
	PRIMARY KEY CLUSTERED (NhanVienID ASC)
)


-- set default value tinhTrang=0-> chua xoa
ALTER TABLE DICHVU ADD  CONSTRAINT DF_DICHVU_TinhTrangTonTai  DEFAULT ((0)) FOR TinhTrangTonTai

GO
ALTER TABLE KHACHHANG ADD  CONSTRAINT DF_KHACHHANG_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO
ALTER TABLE LOAIDV ADD  CONSTRAINT DF_LOAIDV_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO
ALTER TABLE LOAIPHONG ADD  CONSTRAINT DF_LOAIPHONG_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO
ALTER TABLE NHANVIEN ADD  CONSTRAINT DF_NHANVIEN_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO
ALTER TABLE PHONG ADD  CONSTRAINT DF_PHONG_TinhTrangTonTai  DEFAULT ((0)) FOR TinhTrangTonTai
GO
ALTER TABLE PHONG ADD  CONSTRAINT DF_PHONG_TinhTrangThue  DEFAULT ((0)) FOR TinhTrangThue
GO
--Khoa Ngoai
ALTER TABLE DICHVU  WITH CHECK ADD  CONSTRAINT FK_DICHVU_LOAIDV FOREIGN KEY(LoaiDVID)
REFERENCES LOAIDV (LoaiDVID)
GO
ALTER TABLE DICHVU CHECK CONSTRAINT FK_DICHVU_LOAIDV
GO
ALTER TABLE HOADONTHUEPHONG  WITH CHECK ADD  CONSTRAINT FK_HOADONTHUEPHONG_KHACHHANG FOREIGN KEY(MaKhachHang)
REFERENCES KHACHHANG (MaKH)
GO
ALTER TABLE HOADONTHUEPHONG CHECK CONSTRAINT FK_HOADONTHUEPHONG_KHACHHANG
GO
ALTER TABLE HOADONTHUEPHONG  WITH CHECK ADD  CONSTRAINT FK_HOADONTHUEPHONG_NHANVIEN FOREIGN KEY(NhanVienTaoHoaDon)
REFERENCES NHANVIEN (NhanVienID)
GO
ALTER TABLE HOADONTHUEPHONG CHECK CONSTRAINT FK_HOADONTHUEPHONG_NHANVIEN
GO
ALTER TABLE HOADONTHUEPHONG  WITH CHECK ADD  CONSTRAINT FK_HOADONTHUEPHONG_PHONG FOREIGN KEY(Phong)
REFERENCES PHONG (PhongID)
GO
ALTER TABLE HOADONTHUEPHONG CHECK CONSTRAINT FK_HOADONTHUEPHONG_PHONG
GO
ALTER TABLE LICHSUTHEMDICHVU  WITH CHECK ADD  CONSTRAINT FK_LICHSUTHEMDICHVU_DICHVU FOREIGN KEY(DichVuID)
REFERENCES DICHVU (DichVuID)
GO
ALTER TABLE LICHSUTHEMDICHVU CHECK CONSTRAINT FK_LICHSUTHEMDICHVU_DICHVU
GO
ALTER TABLE LICHSUTHEMDICHVU  WITH CHECK ADD  CONSTRAINT FK_LICHSUTHEMDICHVU_HOADONTHUEPHONG FOREIGN KEY(MaHoaDon)
REFERENCES HOADONTHUEPHONG (MaHoaDon)
GO
ALTER TABLE LICHSUTHEMDICHVU CHECK CONSTRAINT FK_LICHSUTHEMDICHVU_HOADONTHUEPHONG
GO
ALTER TABLE NVKETOAN  WITH CHECK ADD  CONSTRAINT FK_NVKETOAN_NHANVIEN FOREIGN KEY(NhanVienID)
REFERENCES NHANVIEN (NhanVienID)
GO
ALTER TABLE NVKETOAN CHECK CONSTRAINT FK_NVKETOAN_NHANVIEN
GO
ALTER TABLE NVLETAN  WITH CHECK ADD  CONSTRAINT FK_NVLETAN_NHANVIEN FOREIGN KEY(NhanVienID)
REFERENCES NHANVIEN (NhanVienID)
GO
ALTER TABLE NVLETAN CHECK CONSTRAINT FK_NVLETAN_NHANVIEN
GO
ALTER TABLE NVQUANLI  WITH CHECK ADD  CONSTRAINT FK_NVQUANLI_NHANVIEN FOREIGN KEY(NhanVienID)
REFERENCES NHANVIEN (NhanVienID)
GO
ALTER TABLE NVQUANLI CHECK CONSTRAINT FK_NVQUANLI_NHANVIEN
GO
ALTER TABLE PHONG  WITH CHECK ADD  CONSTRAINT FK_PHONG_LOAIPHONG FOREIGN KEY(LoaiPhongID)
REFERENCES LOAIPHONG (LoaiPhongID)
GO
ALTER TABLE PHONG CHECK CONSTRAINT FK_PHONG_LOAIPHONG

USE QLKHACHSAN

--Them vao csdl

GO
INSERT INTO NHANVIEN(TenDangNhap, MatKhau, HoTen, DiaChi, NgaySinh, SDT,CMND, Email, Loai)
VALUES('admin', 'admin', N'Nguyễn Hoàng Quyên', N'KTX 135B Trần Hưng Đạo, Phường Cầu Ông Lãnh, Quận 1, TPHCM', CAST(N'1999-07-03' AS Date), 0345650858,312395992, 'hoangquyen7901@gmail.com',1)

GO
INSERT INTO LOAIPHONG(LoaiPhongID, TenLoai)
VALUES('THUONG1', N'Loại phòng thường 1 giường'),
('THUONG2', N'Loại phòng thường giường đôi'),
('VIP1', N'Loại phòng cao cấp 1 giường'),
('VIP2', N'Loại phòng cao cấp giường đôi')

GO 
INSERT INTO PHONG(PhongID, TenPhong, DonGia, LoaiPhongID)
VALUES('P101', N'Phòng 101, lầu 1', 200000, 'THUONG1'),
('P102', N'Phòng 102, lầu 1', 390000, 'THUONG2'),
('P201', N'Phòng 201, lầu 2', 400000, 'VIP1'),
('P301', N'Phòng 201, lầu 3', 850000, 'VIP2')

GO
INSERT INTO LOAIDV(LoaiDVID, TenLoai)
VALUES('GIAT', N'Loại dịch vụ giặt ủi'),
('UONG', N'Loại dịch vụ đồ uống'),
('THUCPHAM', N'Loại dịch vụ đồ ăn')

GO 
INSERT INTO DICHVU(DichVuID, TenDichVu, GiaBan, GiaCungCap, LoaiDVID, DonVi)
VALUES('DV001', N'Giặt ủi sấy khô', 50000, 30000, 'GIAT', N'Kí'),
('DV002', N'Nước suối Aquafina', 10000, 5000, 'UONG', N'Chai'),
('DV003', N'Nước tăng lực Sting dâu chai 330ml', 15000, 8000, 'UONG', N'Chai'),
('DV004', N'Mì Handy Hảo Hảo tôm chua cay ly 67g', 15000, 9000, 'THUCPHAM', N'Ly'),
('DV005', N'Snack pho mát miếng Oishi gói 40g', 8000, 5000, 'GIAT', N'Bịt')

GO
INSERT INTO KHACHHANG(HoTen, SDT, CMND, DiaChi, NgayTao) VALUES(N'Nguyễn Hoàng Quyên',0343650858,312395992,N'KTX Trần Hưng Đạo',CAST(N'2020-08-05' AS Date))

CREATE TABLE LOAINHANVIEN(
	LoaiNVID int NOT NULL,
	TenLoai nvarchar(200) NOT NULL,
	TinhTrang bit NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT FK_LOAINV_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_LoaiNV 
	PRIMARY KEY CLUSTERED LoaiNVID ASC))
ALTER TABLE NHANVIEN WITH CHECK ADD  CONSTRAINT FK_NHANVIEN_LOAINHANVIEN FOREIGN KEY(Loai)
REFERENCES LOAINHANVIEN(LoaiNVID )
GO
ALTER TABLE NHANVIEN CHECK CONSTRAINT FK_NHANVIEN_LOAINHANVIEN
GO
ALTER TABLE LOAINHANVIEN ADD  CONSTRAINT DF_LOAINV_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO

GO
INSERT INTO LOAIDV(LoaiDVID, TenLoai)
VALUES('1', N'Nhân viên quản lí'),
('2', N'Nhân viên kế Toán'),
('3', N'Nhân viên lễ tân')

CREATE TABLE LOAINHANVIEN(
	LoaiNVID int NOT NULL,
	TenLoai nvarchar(200) NOT NULL,
	TinhTrang bit NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT FK_LOAINV_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_LoaiNV 
	PRIMARY KEY CLUSTERED (LoaiNVID ASC))
ALTER TABLE LOAINHANVIEN ADD  CONSTRAINT DF_LOAINV_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO

ALTER TABLE NHANVIEN WITH CHECK ADD  CONSTRAINT FK_NHANVIEN_LOAINHANVIEN FOREIGN KEY(Loai)
REFERENCES LOAINHANVIEN(LoaiNVID )
GO
ALTER TABLE NHANVIEN CHECK CONSTRAINT FK_NHANVIEN_LOAINHANVIEN
GO

GO
INSERT INTO LOAINHANVIEN(LoaiNVID, TenLoai)
VALUES('1', N'Nhân viên quản lí'),
('2', N'Nhân viên kế Toán'),
('3', N'Nhân viên lễ tân')

CREATE TABLE BANGTHAMSO(
	MaThamSo varchar(50) NOT NULL,
	TenThamSo nvarchar(200) NOT NULL,
	TinhTrang bit NOT NULL,
	KieuDuLieu varchar(200) NOT NULL,
	GiaTri varchar(200) NOT NULL,
	NgayTao datetime NOT NULL
	CONSTRAINT FK_BANGTHAMSO_NgayTao  DEFAULT (getdate()),
	CONSTRAINT PK_BANGTHAMSO 
	PRIMARY KEY CLUSTERED (MaThamSo ASC))
ALTER TABLE BANGTHAMSO ADD  CONSTRAINT DF_BANGTHAMSO_TinhTrang  DEFAULT ((0)) FOR TinhTrang
GO
GO
INSERT INTO BANGTHAMSO(MaThamSo, TenThamSo, KieuDuLieu, GiaTri)
VALUES('GIA1', N'Phần trăm giá thứ 1', 'INT', '30'),
('GIA2', N'Phần trăm giá thứ 2', 'INT', '50'),
('GIA3', N'Phần trăm giá thứ 3', 'INT', '100'),
('THOIGIANIN1', N'Khung giờ check in thứ 1', 'INT', '5'),
('THOIGIANIN2', N'Khung giờ check in thứ 2', 'INT', '9'),
('THOIGIANIN3', N'Khung giờ check in thứ 3', 'INT', '14'),
('THOIGIANOUT1', N'Khung giờ check out thứ 1', 'INT', '12'),
('THOIGIANOUT2', N'Khung giờ check out thứ 2', 'INT', '15'),
('THOIGIANOUT3', N'Khung giờ check out thứ 3', 'INT', '18')

GO
ALTER TABLE NHANVIEN
ADD AnhDaiDien Image

GO
ALTER TABLE DICHVU
ADD HinhAnh Image 
